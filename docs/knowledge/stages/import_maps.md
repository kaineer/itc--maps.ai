# Импорт данных из открытых источников

## Шаги по реализации

 * В файле stages/import/input.json определяем
   * координаты x и z (latitude и longitude) для левой верхней точки импортируемого прямоугольника в ключах start.lat и start.lng
   * такие же координаты для правой нижней точки (ключи end.lat и end.lng)
   * поле translation
     * имеет значение none, если координаты точек не нужно преобразовывать при получении из xml
     * имеет значение mercator, если координаты точек нужно преобразовывать через проекцию Меркатора
     * имеет значение linear, если координаты точек нужно преобразовывать через простое линейное преобразование
* Получаем данные в xml-формате с url:
  * `https://overpass-api.de/api/map?bbox=lng1,lat1,lng2,lat2`
    * lat и lng берутся из input.json
  * и сохраняем в файл stages/import/map_data.xml

* Дальше нужно импортировать данные, описывающие здания
  * в файле map_data.xml есть теги /*/node и теги /*/way которые мы и будем рассматривать
  * как в тегах node, так и в тегах way есть дочерние теги с именем tag, и атрибутами k и v
  * в случае, если внутри node или way есть тег, у которого k имеет значение "building", а v значение "church", я буду говорить: "для тега node тег building имеет значение church"
  * далее мы выбираем теги way, для которых тег building не пустой
    * для каждого такого тега мы получаем список его узлов, на которые он ссылается через дочерние теги nd (атрибут ref тега nd должен совпадать с атрибутом id предварительно объявленного тега node)
    * в итоге для каждого выбранного нами узла way мы должны получать json-объект, с полями:
      * id -- идентификатор здания в xml-файле
      * nodes -- список узлов, на которые ссылается way через nd-узлы. для каждого узла известны его x и z координаты (в настоящий момент пусть это будут lat и lng). В зависимости от значения в input.json/translation, преобразование координат либо не выполняется, либо выполняется одно из двух указанных
      * address -- формируется из значений тегов "addr:street" и "addr:housenumber", через строку ", "
      * height -- если у здания есть теги, в которых высота указана напрямую, берем значение из них (скорее всего, это будет тег height), если у здания указана этажность (что-то вроде building:levels), умножаем ее на 3 метра, в случае, если даже про этажи ничего нет, просто указываем высоту 3 метра
  * массив полученных объектов мы сохраняем в файл stages/import/buildings.json в ключе buildings
  * после этого, координаты здания с адресом "Чкалова, 3" (то, что имеет большее количество этажей и повыше) записывается в файл stages/import/itc.json в ключ center в том же виде, в котором записываются координаты узлов в файле buildings.json
